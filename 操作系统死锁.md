# 操作系统死锁

## 死锁的概念

当两个线程为了保护两个不同的共享资源⽽使⽤了两个互斥锁，那么这两个互斥锁应⽤不当的时 候，可能会造成两个线程都在等待对⽅释放锁，在没有外⼒的作⽤下，这些线程会⼀直相互等待，就没办 法继续运⾏，这种情况就是发⽣了死锁。

## 死锁条件

死锁只有同时满⾜以下四个条件才会发⽣： 

- 互斥条件；
-  持有并等待条件； 
- 不可剥夺条件； 
- 环路等待条件；

## 避免死锁问题的发⽣

最常⻅的并且可⾏的就是使⽤资源有序分配法，来破环环路等待条件。

> 那什么是资源有序分配法呢？ 线程 A 和 线程 B 获取资源的顺序要⼀样，当线程 A 是先尝试获取资源 A，然后尝试获取资源 B 的时候， 线程 B 同样也是先尝试获取资源 A，然后尝试获取资源 B。也就是说，线程 A 和 线程 B 总是以相同的顺 序申请⾃⼰想要的资源。 我们使⽤资源有序分配法的⽅式来修改前⾯发⽣死锁的代码，我们可以不改动线程 A 的代码。 我们先要清楚线程 A 获取资源的顺序，它是先获取互斥锁 A，然后获取互斥锁 B。 所以我们只需将线程 B 改成以相同顺序的获取资源，就可以打破死锁了。

简单一句话说，大家都按一样的顺序获取锁