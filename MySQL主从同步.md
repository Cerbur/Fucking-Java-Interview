# MySQL主从同步

- master(binlog）主从复制的基础就是主库记录数据库的所有操作更新到 binlog 。binlog 是数据库服务器启动到一颗，保存所有修改数据库结构内容的文件。
- 主节点 log dump 线程，如果 binlog 有变动， log dump会读取变动发送给从节点。
- 从节点 io 线程接受 binlog 内容并写入 relay log 文件中
- 从节点的 SQL 线程读取 relay log 文件对数据更新进行重放，保证主从一致性。

主节点通过 binlog  和 偏移量 来定位主从同步的位置，从节点保存其收到的偏移量，如果从节点发生宕机，会从 position 偏移量的位置发起同步。

mysql 主从同步是异步的，主库发出后便不在理会，而这里就可能出现主库挂了，从库上来时候日志丢失

## 全同步复制

强制同步，等待从库执行完成

## 半同步复制

不用全部从节点响应，可以自定义多少个从库写入则认为写入成功